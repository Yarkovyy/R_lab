---
title: "Лабораторна робота № 4"
author: "&copy; Ярковий Т.С."
date: "`r Sys.Date()`"
output:
#   pdf_document:
#     highlight: tango
#     toc: yes
  html_notebook:
    toc: yes # Генерація змісту документа
    toc_float: true
    highlight: tango # Колір підсвічування коду
fontsize: 12pt # розмір шрифту
header-includes:
 \usepackage[T2A]{fontenc}
 \usepackage[utf8]{inputenc}
 \usepackage[russian]{babel}
editor_options: 
  chunk_output_type: console # вивід результатів обчислень на консоль
---
__Тема:__ Перевірка статистичних гіпотез щодо закону розподілу. 
Перевірка на нормальність. 

__Мета:__ засвоїти ідею методики перевірки статистичних гіпотез щодо 
закону розподілу випадкової величини засобами мови програмування R і, 
зокрема, на нормальність; набути навичок роботи у середовищі RStudio із 
застосуванням концепції «грамотного програмування» із застосуванням пакету 
R Markdown. 


## Виконання завдання


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
NeedPackages <- c("lattice", "nortest", "goftest", "dgof","latex2exp", "beeswarm", "moments", "Hmisc")
#install.packages("NeedPackages")
lapply(NeedPackages, library, character.only = TRUE)

# nortest #Проверка на нормальность
# goftest #Подгонка непрерывных распределений
# dgof    #Подгонка дискретных распределений 
# DAAG    #Анализ данных и графики
# latex2exp #Вывод формул на график в формате TeX
```


### 1. Постановка задачі{#task}

Випадкова величина  $X$  має заданий закон розподілу, вектор параметрів якого відомий. Згенерувати згідно з варіантом вибірку випадкової величини $X=(x_1,...,x_n)$: спочатку об’єму  $n=50$, що має заданий розподіл, обчислити оцінку вектора параметрів розподілу. 
Висунити і перевірити статистичну гіпотезу щодо нормального закону розподілу величини $X$:  
$H_0: f(x) \in \{ N(x, \mu, \sigma^2), \mu \in \mu, \; \sigma^2 \in  \Sigma^2 \}$  
$H_1: f(x) \notin \{ N(x, \mu, \sigma^2), \mu \in \mu, \; \sigma^2 \in  \Sigma^2 \}$  

Повторити дослідження для  $n=1000$. Порівняти результати, зробити висновки.


### 2. Виконання роботи 

__Генеруємо вибірку n=50 за допомогою генератора випадкових чисел і записуємо дані у файл.__

```{r}
# Генерируем выборку в соответствии с заданным распределением
# (В данном случае - нормальный с параметрами "а" и "s")

# Генерируем нормальую выборку
# ВАЖНО!!!- используется аналог функции RANDOMIZE - set.seed()

set.seed(0)
a <- 0
s <- 1
n <- 50
X <- rnorm(n, a, s) #генерируем выборку
head(X)

# Запись выборки в файл
write.table(file = "data/X3.csv", X,
            row.names = FALSE,
            dec = ".",
            col.names = FALSE,
            sep = ";",
            quote = FALSE)
rm(X)
X <- read.table("data/X3.csv")
X <- as.numeric(X$V1)

# Просмотр первых и последних строк таблицы
head(X)
tail(X)

# График выборочных точек
plot(X, main = "Scatterplot", col = 4) # -> График точек

```


#### Функція для оцінки асиметрії та ексцессу та стандартизованих значень асиметрії та ексцесу (рівень 1).  


```{r}


my_summary <- function(X, ...) {
  #Асиметрія та ексцес 
A<-skewness(X)
E<-kurtosis(X)

#Стандаритизовані похибки (формула для малих n)
pA<-sqrt((6*n*(n-1))/((n-2)*(n+1)*(n+3)))
pE<-sqrt((24*n^2*(n-1)^2)/((n-3)*(n-2)*(n +3)*(n+5)))


#Стандартизовані асиметрія та ексцес 
sA<-A/pA
sE<-E/pE
  
  cat( "\n",
    "Асиметрія, A = ", A, "\n",
    "Ексцес, E = ", E, "\n",
    "Стандартизована асиметрія, sA = ", sA, "\n",
    "Стандартизований ексцес, sE = ", sE, "\n"
    )
}

my_summary(X,  na.rm=FALSE)


```



#### Функція, що виводить математичне сподівання, дисперсію, СКВ, оцінки асиметрії, ексцессу та стандартизованих значень асиметрії та ексцесу (рівень 2).  



```{r}

my_summary2 <- function(X, ...) {
  cat("\n", "Результат:", "\n", 
      "математичне сподівання, m = ", mean(X), "\n",
      "дисперсія, s^2 = ", var(X), "\n" ,
      "СКВ, s = ", sd(X)
    )
  my_summary(X,  na.rm=FALSE)
}


my_summary2(X,  na.rm=FALSE)

```


```{r}
# Расчет пяти квантилей 
quantile(X)
```


#### Графіки

```{r}
# Выводим рядом четыре основных графика
op <- par(mfrow = c(3,2)) #Сохраняем старые параметры вывода
dotchart(X, main = "Cleveland's Dot Plots", col = 4) #Точечная диаграмма Кливленда

# Ящик с усами
boxplot(X, width = 2,
        range = 1, 
        col = "gray",
        border = 4, 
        main = "Box-and-Wiskers Plot")

# Гистограмма относительных частот 
hist(X, freq = FALSE,
     breaks = nclass.Sturges(X),
     col = "grey")
curve(dnorm(x, a, s),
      col = 2, 
      lty = 2, 
      lwd = 2, 
      add = TRUE) #сверху кривая плотности
curve(dunif(x, -2, 2),
      col = 3, 
      lty = 2, 
      lwd = 2, 
      add = TRUE) #сверху кривая плотности равномерного распределения
curve(dt(x, df=10),
      col = 4,
      lty = 2,
      lwd = 2,
      add = TRUE) #сверху кривая плотности распределения СТьюдент

# Эмпирическая функция распределения F(x)
Fn <- ecdf(X)
plot(Fn,
     ylab = "",
     verticals = TRUE, 
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     main = "Probability Distribution Function")
curve(pnorm(x, a, s),
      col = 6,
      lty = 1,
      lwd = 2,
      add = TRUE) # -> сверху кривая плотности

curve(pnorm(x, mean(X), sd(X)),
      col = 2,
      lty = 1,
      lwd = 2,
      add = TRUE) # -> сверху кривая плотности.

# Добавляем легенду
legend("bottomright",
       pch = c(19, NA, NA),
       legend = c("Fn(x)", "F(x)","Fvol(x)"),
       lty = c(1,1,1), col = c(4,6,2), lwd = c(NA,2,2))


# Гистограмма частот совместно с кривой эмпирической плотности
# (альтернативны вариаант, описанному выше) 
hist(X, 
     breaks = nclass.Sturges(X),
     freq = FALSE,
     col = "lightblue",
     xlab = "X",
     ylab = "Плотность вероятности",
     main = "Гистограмма, совмещенная с кривой плотности")
lines(density(X),
      col = "red",
      lwd = 2)
# dev.off()


#Q-Q Plot
qqnorm(X, col=4)
qqline(X, col=2)


par(op) #Возвращаем параметры по умолчанию 
```



#### Функція, що виводить у таблицю значення всіх вищезазначених критеріїв та результат перевірки на нормальність (рівень 2).

```{r}

func1 <- function(X, ...) {
  my_summary2(X,  na.rm=FALSE)
  
  # Если p > 0.05 - Нулевая гипотеза не отвергается
  
  #Тест Шапиро-Уилкса 
  if(shapiro.test(X)$p.value>0.05)
    cat("\n", "За тестом Шапиро-Уилкса вірною є перша гіпотеза", "\n")
  else
    cat("\n", "За тестом Шапиро-Уилкса вірною є альтернативна гіпотеза", "\n")
   
  # Тест Колмогорова-Смирнова в модификации Лилиефорса
  if(lillie.test(X)$p.value>0.05)
    cat("\n", "За тестом Колмогорова-Смирнова вірною є перша гіпотеза", "\n")
  else
    cat("\n", "За тестом Колмогорова-Смирнова вірною є альтернативна гіпотеза", "\n")

# Критерий Хи-квадрат Пирсона
if(pearson.test(X)$p.value>0.05)
    cat("\n", "За критерієм Хи-квадрат Пирсона вірною є перша гіпотеза", "\n")
  else
    cat("\n", "За критерієм Хи-квадрат Пирсона  вірною є альтернативна гіпотеза", "\n")

# тест Шапиро-Франсия
if(sf.test(X)$p.value>0.05)
    cat("\n", "За тестом Шапиро-Франсия вірною є перша гіпотеза", "\n")
  else
    cat("\n", "За тестом Шапиро-Франсия вірною є альтернативна гіпотеза", "\n")
}

func1(X,  na.rm=FALSE)

```



#### Обчислення для n = 1000

```{r}
set.seed(0)
a <- 0
s <- 1
n <- 1000
X2 <- rnorm(n, a, s) #генерируем выборку

func1(X2,  na.rm=FALSE)

```



### Висновок
При обчисленні значень у невеликій вибірці точність буде меншою ніж при великих значеннях n. При n = 50 деякі тести на нормальність видають не правильне значення, при n = 1000 всі тести мають однаковий результат.


### Контрольні питання

#### 1. Які основні етапи перевірки статистичних гіпотез щодо закону розподілу, і чому це важливо для статистичного аналізу?

Основні етапи: 

1. Оцінка параметрів розподілу: математичного сподівання, дисперсії,асиметрії, ексцесу.

2. Оцінка ступеня узгодженості гістограми емпіричної функції розподілу з їх параметричними оцінками.

3. Оцінка узгодженості даних за графіком квантілєй.

4. Застосування параметричних і непараметричних критеріїв.

На практиці час від часу можуть виникати задачі, пов’язані з необхідністю встановлювати закон розподілу досліджуваної величини 𝑋, який може мати як дискретний, так і неперервний характер. Найчастіше виникають задачі  перевірки закону розподілу на нормальність: коректне застосування великої кількості самих різних статистичних методів висуває вимогу нормального розподілення досліджуваних випадкових величин.


#### 2. Як використовувати R для визначення нормальності розподілу даних? Які функції або тести можна використовувати для цієї мети?
Функції перевірки на Q-Q графіках, наприклад qqplot, qqline. Перевірка стандартизованих значень асиметрії та ексцесу. Спеціальні тести, наприклад, тест Шапіро-Уилкса, тест Андерсона-Дарлинга та інші.


#### 3. Як використовувати графічні методи, такі як QQ-графік, для оцінки нормальності розподілу даних у R?
Будується Q-Q графік, далі розподіл на цьому графіку порівнюється з лінією нормального розподілу


#### 4. Які можливі наслідки або дії, якщо дані не відповідають припущенню про нормальний розподіл?
Існує багато функцій та методів, які передбачають нормальний розподіл, в разі не відповідності нормальному розподілу, вони не можуть бути використані. Для деяких тестів, що базуються на параметричному підході, нормальність є критичним припущенням. Якщо завдання полягає в прогнозуванні, відсутність нормальності може вплинути на точність прогнозів.